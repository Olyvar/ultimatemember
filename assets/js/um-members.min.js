var um_members_directory_busy=[];function um_set_range_label(e,r){var t=e.siblings(".um-slider-range").data("placeholder");t=r?t.replace("{min_range}",r.values[0]).replace("{max_range}",r.values[1]).replace("{field_label}",e.siblings(".um-slider-range").data("label")):t.replace("{min_range}",e.slider("values",0)).replace("{max_range}",e.slider("values",1)).replace("{field_label}",e.siblings(".um-slider-range").data("label")),e.siblings(".um-slider-range").html(t),e.siblings(".um_range_min").val(e.slider("values",0)),e.siblings(".um_range_max").val(e.slider("values",1))}function IsValidJSONString(e){try{JSON.parse(e)}catch(e){return!1}return!0}function um_set_directory_storage(e,r,t,a){if(a||null===sessionStorage.getItem("um_directory_"+um_members_get_unique_id(e)+"_"+r)){var i=t;return"object"==typeof t&&(i=JSON.stringify(t)),sessionStorage.setItem("um_directory_"+um_members_get_unique_id(e)+"_"+r,i),t}return um_get_directory_storage(e,r)}function um_get_directory_storage(e,r){var t=sessionStorage.getItem("um_directory_"+um_members_get_unique_id(e)+"_"+r);return IsValidJSONString(t)?JSON.parse(t):t}function um_delete_directory_storage(e,r){sessionStorage.removeItem("um_directory_"+um_members_get_unique_id(e)+"_"+r)}function um_members_get_unique_id(e){return e.data("unique_id")}function um_is_directory_busy(e){var r=um_members_get_unique_id(e);return void 0!==um_members_directory_busy[r]&&um_members_directory_busy[r]}function um_members_show_preloader(e){um_members_directory_busy[um_members_get_unique_id(e)]=!0,e.find(".um-members-overlay").show()}function um_members_hide_preloader(e){um_members_directory_busy[um_members_get_unique_id(e)]=!1,e.find(".um-members-overlay").hide()}function um_ajax_get_members(a){var e=a.data("unique_id");e=e.replace("um-","");var r=-(new Date).getTimezoneOffset()/60,i={page:um_get_directory_storage(a,"page"),args:window["um_members_args_"+e],gmt_offset:r,nonce:window.um_scripts.nonce,referrer_url:window.location.href};return a.find(".um-member-directory-sorting-options").length&&(i.sorting=um_get_directory_storage(a,"sorting")),a.find(".um-search-line").length&&(i.general_search=um_get_directory_storage(a,"general_search")),a.find(".um-search-filter").length&&a.find(".um-search-filter").each(function(){var e=jQuery(this);if(e.find(".um-slider").length){var r=e.find(".um-slider").data("field_name");null!==(t=um_get_directory_storage(a,"filter_"+r))&&(i[r]=t,i.is_filters=!0)}else if(e.find(".um-datepicker-filter").length){r=e.find(".um-datepicker-filter").data("filter_name");null!==(t=um_get_directory_storage(a,"filter_"+r))&&(i[r]=t,i.is_filters=!0)}else{var t;r=e.find("select").attr("name");null!==(t=um_get_directory_storage(a,"filter_"+r))&&(i[r]=t,i.is_filters=!0)}}),wp.ajax.send("um_get_members",{data:i,success:function(e){um_set_directory_storage(a,"last_data",e,!0),um_build_template(a,e),um_members_hide_preloader(a);var r=wp.template("um-members-pagination");a.find(".um-members-pagination-box").html(r(e)),a.data("total_pages",e.pagination.total_pages),jQuery(document).trigger("um_members_rendered")},error:function(e){console.log(e)}})}function um_build_template(e,r){var t=um_get_directory_storage(e,"layout"),a=wp.template("um-member-"+t);e.find(".um-members-grid, .um-members-list").remove(),e.find(".um-members-wrapper").prepend(a(r)),e.addClass("um-loaded"),e.find(".um-members").length&&(UM_Member_Grid(e.find(".um-members")),jQuery(window).trigger("resize")),jQuery(document).trigger("um_build_template",[e,r]),jQuery(window).trigger("resize")}function UM_Member_Grid(e){e.find(".um-member").length&&e.imagesLoaded(function(){e.masonry({itemSelector:".um-member",columnWidth:".um-member",gutter:".um-gutter-sizer"}).on("layoutComplete",function(e,r){jQuery(document).trigger("um_grid_initialized",[e,r])})})}function um_change_tag(n){var s=um_members_get_unique_id(n),d=[],_=[];n.find(".um-search-filter").each(function(){var e,t,a,r,i,u,m=jQuery(this);m.find("input.um-datepicker-filter").length?(e="datepicker",m.find("input.um-datepicker-filter").each(function(){var e=jQuery(this),r={};e.length&&(a=um_get_directory_storage(n,"filter_"+e.data("filter_name")),t=e.data("filter_name"),i=e.data("range"),null!==a&&a[i]&&(r.name=t,r.label=e.attr("placeholder"),r.range=i,r.value_title=e.val(),_.push(r)))})):m.find("select").length?(e="select",t=m.find("select").attr("name"),a=um_get_directory_storage(n,"filter_"+t),r=m.find("select").data("placeholder")):m.find("div.ui-slider").length&&(e="slider",t=m.find("div.ui-slider").data("field_name"),a=um_get_directory_storage(n,"filter_"+t),r=m.find("div.um-slider-range").data("label")),void 0!==a&&null!=a&&("string"==typeof a?(u=m.find('select option[value="'+a+'"]').data("value_label"),d.push({name:t,label:r,value_label:u,value:a,unique_id:s})):"datepicker"==e?jQuery.each(_,function(r){void 0===d.find(function(e){return e.name==_[r].name&&e.range==_[r].range})&&d.push({name:_[r].name,range:_[r].range,label:_[r].label,value_label:_[r].value_title,value:a[_[r].range],unique_id:s})}):"slider"==e?(u=a[0]+" - "+a[1],d.push({name:t,label:r,value_label:u,value:a,unique_id:s})):jQuery.each(a,function(e){u=m.find('select option[value="'+a[e]+'"]').data("value_label"),d.push({name:t,label:r,value_label:u,value:a[e],unique_id:s})}))}),n.find(".um-members-filter-tag").remove();var e=wp.template("um-members-filtered-line");n.find(".um-filtered-line").prepend(e({filters:d})),0<d.length?(n.find(".um-filtered-line").show(),show_after_search=!1):(n.find(".um-filtered-line").hide(),show_after_search=!0),0===n.find(".um-members-filter-remove").length?n.find(".um-clear-filters-a").hide():n.find(".um-clear-filters-a").show()}jQuery(document).ready(function(){jQuery(".um-slider").each(function(){var e=jQuery(this),t=jQuery(this).parents(".um-directory"),r=um_get_directory_storage(t,"filter_"+e.data("field_name"));null==r&&(r=[parseInt(e.data("min")),parseInt(e.data("max"))]),e.slider({range:!0,min:parseInt(e.data("min")),max:parseInt(e.data("max")),values:r,create:function(e,r){},step:1,slide:function(e,r){um_set_range_label(jQuery(this),r)},stop:function(e,r){um_is_directory_busy(t)||(um_set_directory_storage(t,"filter_"+jQuery(this).data("field_name"),r.values,!0),um_set_directory_storage(t,"page",1,!0),um_change_tag(t),um_ajax_get_members(t))}}),um_set_range_label(e)}),jQuery(".um-datepicker-filter").each(function(){var n=jQuery(this),e=new Date(1e3*n.data("date_min")),r=new Date(1e3*n.data("date_max")),t=n.pickadate({selectYears:!0,min:e,max:r,formatSubmit:"yyyy/mm/dd",hiddenName:!0,onOpen:function(){n.blur()},onClose:function(){n.blur()},onSet:function(e){var r=n.parents(".um-directory");if(!um_is_directory_busy(r)){var t=n.data("filter_name"),a=n.data("range"),i=um_get_directory_storage(r,"filter_"+t);null===i&&(i={});var u=e.select/1e3,m=n.val();"from"===a?null===u||isNaN(u)?""==m&&delete i.from:i.from=u:"to"===a&&(null===u||isNaN(u)?""==m&&delete i.to:i.to=u),um_set_directory_storage(r,"filter_"+t,i,!0),um_set_directory_storage(r,"page",1,!0),um_ajax_get_members(r),um_change_tag(r)}}}).pickadate("picker"),a=n.data("filter_name"),i=n.data("range"),u=um_get_directory_storage(n.parents(".um-directory"),"filter_"+a);null!==u&&void 0!==u[i]&&t.set("select",1e3*u[i])}),jQuery(".um-directory").each(function(){var e=jQuery(this);um_members_show_preloader(e);var r=e.data("view_type");if(r=um_set_directory_storage(e,"layout",r),e.find(".um-member-directory-view-type-a").length){var t=e.find(".um-member-directory-view-type-a").parent(),a=um_get_directory_storage(e,"layout"),i=t.find(".um-member-directory-view-type-a").length;t.find(".um-member-directory-view-type-a").each(function(e,r){if(jQuery(r).data("type")==a){if(jQuery(r).show(),e===i-1)var t=jQuery(r).prevAll().last().attr("default-title");else t=jQuery(r).next().attr("default-title");jQuery(r).attr("original-title",t)}else jQuery(r).hide()})}if(um_set_directory_storage(e,"page",1),e.find(".um-member-directory-sorting-options").length){var u=um_set_directory_storage(e,"sorting",e.find(".um-member-directory-sorting-options").val());e.find(".um-member-directory-sorting-options").val(u)}var m=!1;if(e.find(".um-search-line").length){var n=um_get_directory_storage(e,"general_search");null!==n?e.find(".um-search-line").val(n):m=!0}e.find(".um-member-directory-sorting-options").length&&null!==(u=um_get_directory_storage(e,"sorting"))&&e.find(".um-member-directory-sorting-options").val(u).trigger("change");jQuery("#tmpl-um-members-filtered-line").length&&um_change_tag(e),0<e.data("only_search")&&m?um_members_hide_preloader(e):um_ajax_get_members(e)}),jQuery(document.body).on("click",".um-member-directory-view-type-a",function(){var t=jQuery(this).parents(".um-directory");jQuery(this);if(um_is_directory_busy(t))return!1;var a,i,u=um_get_directory_storage(t,"layout"),e=t.find(".um-member-directory-view-type-a").parent(),m=jQuery(this).parent().find(".um-member-directory-view-type-a").length;e.find(".um-member-directory-view-type-a").each(function(e,r){jQuery(r).data("type")==u&&(i=e===m-1?(a=jQuery(r).parent().find(".um-member-directory-view-type-a").eq(0),jQuery(a).next().attr("default-title")):(a=jQuery(r).parent().find(".um-member-directory-view-type-a").eq(e+1),e===m-2?jQuery(r).parent().find(".um-member-directory-view-type-a").eq(0).attr("default-title"):jQuery(a).next().attr("default-title")))}),jQuery(this).parent().find(".um-member-directory-view-type-a").hide(),a.show(),a.attr("original-title",i),u=jQuery(a).data("type"),um_set_directory_storage(t,"layout",u,!0),t.data("view_type",u);var r=um_get_directory_storage(t,"last_data");if(null!==r)um_build_template(t,r);else{var n=!1;if(t.find(".um-search-line").length)null===um_get_directory_storage(t,"general_search")&&(n=!0);if(jQuery("#tmpl-um-members-filtered-line").length){var s=[];t.find(".um-search-filter").each(function(){var e=jQuery(this).find("select").attr("name"),r=um_get_directory_storage(t,"filter_"+e);void 0!==r&&("string"==typeof r?s.push({name:e}):jQuery.each(r,function(){s.push({name:e})}))}),n=s.length<=0}if(1===parseInt(t.data("only_search"))&&n)return;um_members_show_preloader(t),um_ajax_get_members(t)}}),jQuery(document.body).on("click",".um-directory .pagi:not(.current)",function(){if(!jQuery(this).hasClass("disabled")){var e,r=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(r))um_members_show_preloader(r),1===(e="first"===jQuery(this).data("page")?1:"prev"===jQuery(this).data("page")?1*r.data("page")-1:"next"===jQuery(this).data("page")?1*r.data("page")+1:"last"===jQuery(this).data("page")?parseInt(r.data("total_pages")):parseInt(jQuery(this).data("page")))?(r.find('.pagi[data-page="first"], .pagi[data-page="prev"]').addClass("disabled"),r.find('.pagi[data-page="prev"], .pagi[data-page="last"]').removeClass("disabled")):(e===parseInt(r.data("total_pages"))?r.find('.pagi[data-page="prev"], .pagi[data-page="last"]').addClass("disabled"):r.find('.pagi[data-page="prev"], .pagi[data-page="last"]').removeClass("disabled"),r.find('.pagi[data-page="first"], .pagi[data-page="prev"]').removeClass("disabled")),r.find(".pagi").removeClass("current"),r.find('.pagi[data-page="'+e+'"]').addClass("current"),r.data("page",e),um_set_directory_storage(r,"page",e,!0),um_ajax_get_members(r)}}),jQuery(document.body).on("change",".um-directory .um-members-pagi-dropdown",function(){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)){var r=jQuery(this).val();e.find(".pagi").removeClass("current"),e.find('.pagi[data-page="'+r+'"]').addClass("current"),e.data("page",r),um_set_directory_storage(e,"page",r,!0),um_ajax_get_members(e)}}),jQuery(document.body).on("change",".um-member-directory-sorting-options",function(){var t=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(t)){var e=!1;if(t.find(".um-search-line").length)null===um_get_directory_storage(t,"general_search")&&(e=!0);if(jQuery("#tmpl-um-members-filtered-line").length){var a=[];t.find(".um-search-filter").each(function(){var e=jQuery(this).find("select").attr("name"),r=um_get_directory_storage(t,"filter_"+e);void 0!==r&&("string"==typeof r?a.push({name:e}):jQuery.each(r,function(){a.push({name:e})}))}),e=a.length<=0}1===parseInt(t.data("only_search"))&&e||(t.data("sorting",jQuery(this).val()),um_set_directory_storage(t,"sorting",jQuery(this).val(),!0),um_ajax_get_members(t))}}),jQuery(document.body).on("click",".um-do-search",function(){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)){var r=e.find(".um-search-line").val();r===um_get_directory_storage(e,"general_search")||""===r&&null===um_get_directory_storage(e,"general_search")||(e.data("general_search",r),um_set_directory_storage(e,"general_search",r,!0),um_set_directory_storage(e,"page",1,!0),um_ajax_get_members(e))}}),jQuery(document.body).on("keypress",".um-search-line",function(e){13===e.which&&jQuery(this).parents(".um-directory").find(".um-do-search").trigger("click")}),jQuery(".um-member-directory-filters").click(function(){var e=jQuery(this).parents(".um-directory").find(".um-search");e.is(":visible")?e.slideUp(650):e.slideDown(650)}),jQuery(".um-close-filter").click(function(){jQuery(this).parents(".um-directory").find(".um-search").slideUp(650)}),jQuery(document.body).on("change",".um-search-filter select",function(){if(""!==jQuery(this).val()){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)){var r=jQuery(this).prop("name"),t=um_get_directory_storage(e,"filter_"+r);null===t&&(t=[]),-1===jQuery.inArray(jQuery(this).val(),t)&&(t.push(jQuery(this).val()),um_set_directory_storage(e,"filter_"+r,t,!0),um_set_directory_storage(e,"page",1,!0)),jQuery(this).val("").trigger("change"),um_ajax_get_members(e),um_change_tag(e)}}}),jQuery(document.body).on("click",".um-members-filter-remove",function(){var e=jQuery(this).parents(".um-directory");if(!um_is_directory_busy(e)){var r=jQuery(this).data("range"),t=jQuery(this).data("value"),a=jQuery(this).data("name"),i=um_get_directory_storage(e,"filter_"+a);if(null!==i&&-1!=jQuery.inArray(t.toString(),i))0<(i=jQuery.grep(i,function(e){return e!=t})).length?um_set_directory_storage(e,"filter_"+a,i,!0):um_delete_directory_storage(e,"filter_"+a),um_set_directory_storage(e,"page",1,!0),jQuery(this).parents(".um-members-filter-tag").remove();else if(null!==i&&void 0!==i[r])e.find('input.um-datepicker-filter[data-filter_name="'+a+'"][data-range="'+r+'"]').val("").change(),delete i[r],!1===jQuery.isEmptyObject(i)?um_set_directory_storage(e,"filter_"+a,i,!0):um_delete_directory_storage(e,"filter_"+a),jQuery(this).parents(".um-members-filter-tag").remove();else{1<i.length&&i.includes(t)?(i.splice(i.indexOf(t),1),um_set_directory_storage(e,"filter_"+a,i,!0)):um_delete_directory_storage(e,"filter_"+a),jQuery(this).parents(".um-members-filter-tag").remove();var u=jQuery(e).find("div.um-slider");u.slider("values",[parseInt(u.data("min")),parseInt(u.data("max"))])}um_ajax_get_members(e),0===e.find(".um-members-filter-remove").length?e.find(".um-clear-filters-a").hide():e.find(".um-clear-filters-a").show()}}),jQuery(document.body).on("click",".um-clear-filters-a",function(){var u=jQuery(this).parents(".um-directory");um_is_directory_busy(u)||(u.find(".um-members-filter-remove").each(function(){var r=jQuery(this).data("value"),e=jQuery(this).data("name"),t=jQuery(this).data("range"),a=um_get_directory_storage(u,"filter_"+e);if(null!==a&&-1!=jQuery.inArray(r.toString(),a))0<(a=jQuery.grep(a,function(e){return e!=r})).length?um_set_directory_storage(u,"filter_"+e,a,!0):um_delete_directory_storage(u,"filter_"+e),um_set_directory_storage(u,"page",1,!0),jQuery(this).parents(".um-members-filter-tag").remove();else if(null!==a&&void 0!==a[t])u.find('input.um-datepicker-filter[data-filter_name="'+e+'"][data-range="'+t+'"]').val("").change(),delete a[t],!1===jQuery.isEmptyObject(a)?um_set_directory_storage(u,"filter_"+e,a,!0):um_delete_directory_storage(u,"filter_"+e),jQuery(this).parents(".um-members-filter-tag").remove();else{um_delete_directory_storage(u,"filter_"+e),jQuery(this).parents(".um-members-filter-tag").remove();var i=jQuery(u).find("div.um-slider");i.slider("values",[parseInt(i.data("min")),parseInt(i.data("max"))]),um_set_range_label(i)}}),um_set_directory_storage(u,"page",1,!0),u.find(".um-members-filter-tag").remove(),um_ajax_get_members(u),jQuery(this).hide())}),jQuery(document.body).on("click",".um-member-more a",function(){var e=jQuery(this).parents(".um-directory"),r=jQuery(this).parents(".um-member");r.find(".um-member-more").hide(),r.find(".um-member-meta").slideDown(function(){r.find(".um-member-less").fadeIn(),e.find(".um-members").length&&UM_Member_Grid(e.find(".um-members"))}),setTimeout(function(){e.find(".um-members").length&&UM_Member_Grid(e.find(".um-members"))},100)}),jQuery(document.body).on("click",".um-member-less",function(){var e=jQuery(this).parents(".um-directory"),r=jQuery(this).parents(".um-member");r.find(".um-member-less").hide(),r.find(".um-member-meta").slideUp(function(){r.find(".um-member-more").fadeIn(),e.find(".um-members").length&&UM_Member_Grid(e.find(".um-members"))})})});